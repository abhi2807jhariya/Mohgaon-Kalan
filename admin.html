<!DOCTYPE html>
<html lang="hi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" type="text/css" href="style.css" />
  <link rel="stylesheet" type="text/css" href="assets/css/bootstrap.v5.min.css" />
  <link rel="stylesheet" type="text/css" href="assets/css/style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    crossorigin="anonymous" referrerpolicy="no-referrer" />

  <link rel="icon" type="image/png" href="assets/images/favicon.png" />
  <title>Admin | मोहगांव कलॉ</title>

  <style>
    .table th, .table td {
      vertical-align: middle;
    }
  </style>
</head>

<body>
  <div id="header"></div>

  <div class="main-section Event px-3 px-lg-5">
    <div class="container-fluid col-md-12 mb-3 px-2 px-md-5">
      <div class="container mt-5">
        <h2>Feedback Records (Admin)</h2>
        <table id="adminTable" class="table table-bordered table-striped mt-3">
          <thead class="table-dark">
            <tr>
              <th>Sr No</th>
              <th>Name</th>
              <th>Mobile</th>
              <th>Feedback</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <div id="footer"></div>

  <script src="assets/js/include.js"></script>
  <script src="assets/js/weather.js"></script>
  <script src="assets/js/bootstrap.bundle.min.js"></script>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyR2Gk75vJUn-zd_Nykyg2c0WKKr2gUq4py6fUXo4wX67u-A8ahMzPhyDR7YdicucLl/exec";
const tableBody = document.querySelector('#adminTable tbody');

// Load feedbacks from Sheet
async function loadFeedbacks() {
    try {
        const res = await fetch(API_URL);
        const data = await res.json();

        tableBody.innerHTML = "";
        data.forEach((item, index) => {
            const row = `<tr>
                <td>${index + 1}</td>
                <td>${item.Name}</td>
                <td>${item.Mobile}</td>
                <td>${item.Feedback}</td>
                <td>
                    <button class="btn btn-danger btn-sm" onclick="deleteFeedback(${index + 1})">
                        <i class="fa fa-trash"></i> Delete
                    </button>
                </td>
            </tr>`;
            tableBody.innerHTML += row;
        });
    } catch (err) {
        console.error("Error loading feedbacks:", err);
        alert("Feedbacks load nahi ho paaye. Please check API.");
    }
}

// Delete feedback
async function deleteFeedback(srNo) {
    if(!confirm("क्या आप वाकई इस feedback को हटाना चाहते हैं?")) return;

    try {
        const res = await fetch(`${API_URL}?srNo=${srNo}`, { method: "DELETE" });
        const result = await res.json();
        if(result.status === "success") {
            loadFeedbacks();
        } else {
            alert("Error deleting feedback");
        }
    } catch(err) {
        console.error("Error deleting feedback:", err);
        alert("Error deleting feedback. Check console.");
    }
}

// Load feedbacks on page load
loadFeedbacks();
</script>


</body>
</html>
